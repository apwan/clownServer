<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: showing.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: showing.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>$(function() {

	var UserShowObj = {};

	// JQuery 获取前端组件
	var $window = $(window);
	// 结束展示按钮
	var $endShowBtn = $('.endShowBtn');
	// 开始展示按钮
	var $startShowBtn = $('.startShowBtn');
	// 输入slideId
	var $slideIdInput = $('.slideIdInput');
	// 展示区域
	var $showArea = $('.slides');

	/**
	 * 标识是否正在展示
	 * @name started
	 * @type {boolean}
	 */
	var started = false;

	/**
	 * 开始一个展示
	 */
	$startShowBtn.click(function () {
		var slideId = $slideIdInput.val();
		$.post('/ajax/slide-show', {
			slideId: slideId,
			command: 'start'
		}, function (data) {
			if (data.success == 0) {
				// 展示错误信息
				alert(data.errStr);
			}
			else {
				started = true;
				UserShowObj.presId = data.presId;
				// 设置内容
				$showArea.prepend(data.contents);
				$('.presIdText').html(data.presId);
				// 初始化reveal
				Reveal.initialize(
        			{
          				controls: true,
          				progress: true,
          				history: false,
          				center: true,
          				slideNumber: true,

          				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
          				transition: Reveal.getQueryHash().transition || 'default' 
        		});
        		//调用sendChangeState
				Reveal.addEventListener('slidechanged', sendChangeState);
				Reveal.addEventListener('overviewshown', sendChangeState);
				Reveal.addEventListener('overviewhidden', sendChangeState);
			}
		});
	});

	/**
	 * 结束展示
	 * @name endShow
	 * @function
	 */
	$endShowBtn.click(function() {
		$.post('/ajax/slide-show/', {
			'command': 'end',
			'presId': UserShowObj.presId,
		});
		started = false;
	});


	function sendChangeState() {
		console.log('hi');
		var params = {
			'presId': UserShowObj.presId,
			'newState': JSON.stringify(Reveal.getState()),
		};
		$.post('/ajax/slide-change/', params);
	};

	// 退出前询问
	$window.on('beforeunload', function() {
		if (started) 
			return "你正在进行展示";
	});

	$window.unload(function() {
		if (started) {
			$.post('/ajax/slide-show', {
				'command': 'end',
				'presId': UserShowObj.presId,
			});
		}
	});
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addChatMessage">addChatMessage</a></li><li><a href="global.html#cleanInput">cleanInput</a></li><li><a href="global.html#connected">connected</a></li><li><a href="global.html#createRequest">createRequest</a></li><li><a href="global.html#endShow">endShow</a></li><li><a href="global.html#getShowState">getShowState</a></li><li><a href="global.html#getUsernameColor">getUsernameColor</a></li><li><a href="global.html#onLogin">onLogin</a></li><li><a href="global.html#onShowEnd">onShowEnd</a></li><li><a href="global.html#onSlideChange">onSlideChange</a></li><li><a href="global.html#onUserJoined">onUserJoined</a></li><li><a href="global.html#onUserLeft">onUserLeft</a></li><li><a href="global.html#post">post</a></li><li><a href="global.html#sendMessage">sendMessage</a></li><li><a href="global.html#started">started</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha13</a> on Fri Jan 09 2015 01:43:55 GMT+0800 (HKT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
